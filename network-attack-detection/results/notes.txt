num name                            types               malware 	type    Total    	Malicious 	C&C 	Botnet 	Data Status
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
01  capture20110810.binetflow       IRC,Spam,CF       	neris		test    2824636		40961   	341		40620	OK|NO|NO|NO	
02  capture20110811.binetflow       IRC,Spam,CF       	neris		test    1808122 	20941   	673		20268	OK|NO|NI|NO
03  capture20110812.binetflow       IRC,PS,US         	rbot		train   4710638 	26822   	63		26759	OK|OK|OK|OK
04  capture20110815.binetflow       IRC,DDoS,US       	rbot		train   1121076 	2580    	52		2528	OK|NO|NO|NO data cleasing problem (1768 instead of 2580)
05  capture20110815-2.binetflow     Spam,PS,HTTP      	virut		train   129832 		901     	24		877		OK|OK|NO|NO
06  capture20110816.binetflow       PS                  menti		test    558919 		4630    	199		4431	OK|OK|OK|OK
07  capture20110816-2.binetflow     HTTP                sogou		train   114077 		63      	26		37		OK|OK|OK|OK
08  capture20110816-3.binetflow     PS                  murlo		test    2954230 	6127    	1074	5053	OK|OK|OK|OK
09  capture20110817.binetflow       IRC,Spam,CF,PS 		neris		test    2087508 	184987  	2973	182014	NO|NO|NO|NO
10  capture20110818.binetflow       IRC,DDoS,US        	rbot		train   1309791 	106352  	33		106319	OK|NO|NO|NO data cleasing problem (375 instead of 106352)
11  capture20110818-2.binetflow     IRC,DDoS,US        	rbot		train   107251 		8164   		2 		8162	OK|NO|NO|OK data cleasing problem (21 instead of 8164)
12  capture20110819.binetflow       P2P                 nsys.ay		train   325471  	2168    	25		2143 	OK|OK|OK|OK
13  capture20110815-3.binetflow     Spam,PS,HTTP      	virut		train   1925149 	40003   	536		39467	OK|NO|NO|NO
==============================================================================================================================================================================================================================
pkl                 raw in pkl format
pkl_all             raw_all in pkl format
pkl_all_test        raw_all_test in pkl format
pkl_all_train       raw_all_train in pkl format
pkl_attack          raw_attack in pkl format
pkl_cc              raw_cc in pkl format
pkl_normal          raw_normal in pkl format
raw                 raw and original files in binetflow/csv format
raw_all             raw data into one binetflow/csv format
raw_all_test        test raw data selected according to original paper
raw_all_train       train raw data selected according to original paper
raw_attack          attack traffic from raw data (labeled as "botnet" but excluding cases with "-cc")
raw_cc              attack traffic from raw data (labeled as "botnet" and "-cc")
raw_normal     		normal traffic
==============================================================================================================================================================================================================================
 - Features
	StartTime,Dur,Proto,SrcAddr,Sport,Dir,DstAddr,Dport,State,sTos,dTos,TotPkts,TotBytes,SrcBytes,Label
 - Attack Types
	CF: Click Fraud; 
	PS: Port Scan; 
	FF: FastFlux; 
	US: Compiled and Controled by Authors
	SPAM
	DDOS
 - C&C Types
	IRC
	P2P
	HTTP
 - File Types:
	*.pcap.netflow.labeled
		Has more lines than the description in https://mcfp.weebly.com/the-ctu-13-dataset-a-labeled-dataset-with-botnet-normal-and-background-traffic.html 
		Clear labels for Ligitimate, Background and Botnet, but without indicate C&C traffic
	*.binetflow
		The amount of lines match with the description https://mcfp.weebly.com/the-ctu-13-dataset-a-labeled-dataset-with-botnet-normal-and-background-traffic.html
		label between botnet and background, without information about legitimate.
		CC traffic can be identified from Botnet labels
	*.binetflow.2format
		The amount of lines match with the description in https://mcfp.weebly.com/the-ctu-13-dataset-a-labeled-dataset-with-botnet-normal-and-background-traffic.html 
		More features than .binetflow format
 - we consider botnet traffic the attacks and c&c
 - Original paper: An empirical comparison of botnet detection - computer and security - 2014
	Testing: 1,2,6,8,9
	Training and cross-validation: 3,4,5,7,10,11,12,13
 - The Botnet traffic comes from the infected hosts, the Normal traffic from the verified normal hosts and the Background traffic is all the rest of traffic that we don’t know what it is for sure.
 - The CTU-13 dataset consists in thirteen captures (called scenarios) of different botnet samples. On each scenario we executed a specific malware, which used several protocols and performed different actions.
 - predict compare to train dist or to new dist? Compare to new dist. if it uses the train dist to get threshold the result is very poor, such as classifing all as outlier
==============================================================================================================================================================================================================================


a diferença está que tradicional mcd define o self.threshold_ e a contaminação a partir do treinamento, nós definimos apenas a contaminação a partir do treinamento, o threshold_ é definido para cada teste a partir do threshold. isto torna a avaliação mais adaptativa


/usr/bin/python3 /home/thiago/dev/anomaly-detection/network-attack-detection/botnet-detection-c-mcd.py
## Sample File:  data/ctu_13/pkl_sum_fast/2s_18-2.pk1
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.2 , F1: 0.8 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.5238095238095238 , Recall: 1.0 , Precision: 0.3548387096774194
###[k-mcd][ drop_features00 ] Test. F1: 0.8 , Recall: 0.6666666666666666 , Precision: 1.0
###[s-mcd][ drop_features00 ] Test. F1: 0.8 , Recall: 0.6666666666666666 , Precision: 1.0
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.23333333333333336 , F1: 0.8620689655172413 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.5238095238095238 , Recall: 1.0 , Precision: 0.3548387096774194
###[k-mcd][ drop_features00 ] Test. F1: 0.8620689655172413 , Recall: 0.7575757575757576 , Precision: 1.0
###[s-mcd][ drop_features00 ] Test. F1: 0.8275862068965517 , Recall: 0.7272727272727273 , Precision: 0.96
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.3666666666666667 , F1: 0.821917808219178 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.5076923076923077 , Recall: 1.0 , Precision: 0.3402061855670103
###[k-mcd][ drop_features00 ] Test. F1: 0.7671232876712328 , Recall: 0.8484848484848485 , Precision: 0.7
###[s-mcd][ drop_features00 ] Test. F1: 0.7397260273972603 , Recall: 0.8181818181818182 , Precision: 0.675
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.2666666666666667 , F1: 0.8709677419354839 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.515625 , Recall: 1.0 , Precision: 0.3473684210526316
###[k-mcd][ drop_features00 ] Test. F1: 0.8064516129032258 , Recall: 0.7575757575757576 , Precision: 0.8620689655172413
###[s-mcd][ drop_features00 ] Test. F1: 0.8064516129032258 , Recall: 0.7575757575757576 , Precision: 0.8620689655172413
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.30000000000000004 , F1: 0.8181818181818182 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.5116279069767442 , Recall: 1.0 , Precision: 0.34375
###[k-mcd][ drop_features00 ] Test. F1: 0.7878787878787878 , Recall: 0.7878787878787878 , Precision: 0.7878787878787878
###[s-mcd][ drop_features00 ] Test. F1: 0.7575757575757576 , Recall: 0.7575757575757576 , Precision: 0.7575757575757576
--- 5.339690446853638 seconds ---


/usr/bin/python3 /home/thiago/dev/anomaly-detection/network-attack-detection/botnet-detection-c-mcd.py
## Sample File:  data/ctu_13/pkl_sum_fast/2s_18-2.pk1
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.30000000000000004 , F1: 0.9090909090909091 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.7272727272727273 , Recall: 0.7272727272727273 , Precision: 0.7272727272727273
###[k-mcd][ drop_features00 ] Test. F1: 0.7575757575757576 , Recall: 0.7575757575757576 , Precision: 0.7575757575757576
###[s-mcd][ drop_features00 ] Test. F1: 0.7575757575757576 , Recall: 0.7575757575757576 , Precision: 0.7575757575757576
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.4 , F1: 0.8421052631578948 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.736842105263158 , Recall: 0.8484848484848485 , Precision: 0.6511627906976745
###[k-mcd][ drop_features00 ] Test. F1: 0.7631578947368421 , Recall: 0.8787878787878788 , Precision: 0.6744186046511628
###[s-mcd][ drop_features00 ] Test. F1: 0.7631578947368421 , Recall: 0.8787878787878788 , Precision: 0.6744186046511628
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.3666666666666667 , F1: 0.8767123287671234 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.7397260273972603 , Recall: 0.8181818181818182 , Precision: 0.675
###[k-mcd][ drop_features00 ] Test. F1: 0.7945205479452054 , Recall: 0.8787878787878788 , Precision: 0.725
###[s-mcd][ drop_features00 ] Test. F1: 0.7397260273972603 , Recall: 0.8181818181818182 , Precision: 0.675
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.2666666666666667 , F1: 0.8709677419354839 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.7741935483870968 , Recall: 0.7272727272727273 , Precision: 0.8275862068965517
###[k-mcd][ drop_features00 ] Test. F1: 0.8064516129032258 , Recall: 0.7575757575757576 , Precision: 0.8620689655172413
###[s-mcd][ drop_features00 ] Test. F1: 0.8064516129032258 , Recall: 0.7575757575757576 , Precision: 0.8620689655172413
###[c-mcd][ drop_features00 ] Cross-Validation. Contamination: 0.2666666666666667 , F1: 0.8709677419354839 , Alg: k-mcd
###[mcd][ drop_features00 ] Test. F1: 0.7741935483870968 , Recall: 0.7272727272727273 , Precision: 0.8275862068965517
###[k-mcd][ drop_features00 ] Test. F1: 0.8064516129032258 , Recall: 0.7575757575757576 , Precision: 0.8620689655172413
###[s-mcd][ drop_features00 ] Test. F1: 0.8064516129032258 , Recall: 0.7575757575757576 , Precision: 0.8620689655172413
--- 6.1850221157073975 seconds ---

Process finished with exit code 0
